{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-16">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8">Custom Packaging Quote Calculator</h1>
        
        <!-- Progress Steps -->
        <div class="mb-8">
            <div class="flex justify-between">
                <div class="w-1/3 text-center">
                    <div class="w-8 h-8 mx-auto bg-wood-brown text-white rounded-full flex items-center justify-center mb-2">1</div>
                    <span class="text-sm font-medium">Package Details</span>
                </div>
                <div class="w-1/3 text-center">
                    <div class="w-8 h-8 mx-auto bg-wood-accent text-wood-dark rounded-full flex items-center justify-center mb-2">2</div>
                    <span class="text-sm font-medium">Specifications</span>
                </div>
                <div class="w-1/3 text-center">
                    <div class="w-8 h-8 mx-auto bg-wood-accent text-wood-dark rounded-full flex items-center justify-center mb-2">3</div>
                    <span class="text-sm font-medium">Requirements</span>
                </div>
            </div>
            <div class="relative mt-2">
                <div class="absolute top-1/2 transform -translate-y-1/2 h-1 bg-wood-accent w-full"></div>
                <div class="absolute top-1/2 transform -translate-y-1/2 h-1 bg-wood-brown" style="width: 33%"></div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-lg p-6">
            <!-- Quote Guidelines -->
            <div class="mb-8 p-4 bg-wood-accent bg-opacity-10 rounded-lg">
                <h2 class="text-lg font-semibold mb-2 flex items-center">
                    <i class="fas fa-info-circle mr-2 text-wood-brown"></i>
                    Quick Guide
                </h2>
                <ul class="space-y-2 text-sm text-gray-600">
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-wood-brown mt-1 mr-2"></i>
                        <span>Enter accurate dimensions in inches for the most precise quote</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-wood-brown mt-1 mr-2"></i>
                        <span>Include all special requirements that apply to your shipment</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-wood-brown mt-1 mr-2"></i>
                        <span>For items over 50,000 lbs or very large dimensions, please contact us directly</span>
                    </li>
                </ul>
            </div>

            <form id="quoteForm" class="space-y-6" method="POST">
                <!-- Package Type -->
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-2">
                        Package Type
                        <span class="text-wood-brown ml-1" title="Choose the type of packaging that best suits your needs">
                            <i class="fas fa-question-circle"></i>
                        </span>
                    </label>
                    <select name="package_type" class="w-full rounded-md border-gray-300" required
                            data-helper="Select the most appropriate package type for your shipping needs">
                        <option value="">Select Package Type</option>
                        <option value="export_crate" data-description="Heat-treated and certified for international shipping">ISPM 15 Export Crate</option>
                        <option value="cushioned_crate" data-description="Added protection for sensitive equipment">Cushioned Crate</option>
                        <option value="skidmate" data-description="Specialized skid system for export">Export Skidmate</option>
                        <option value="cushion_skid" data-description="Includes built-in ramp system">Cushion Skid with Ramp</option>
                        <option value="oversize" data-description="For large industrial equipment">Oversize Crate</option>
                    </select>
                    <p class="mt-1 text-sm text-gray-500 package-description"></p>
                </div>

                <!-- Dimensions -->
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-2">
                        Dimensions
                        <span class="text-wood-brown ml-1" title="Enter the exact measurements of your item">
                            <i class="fas fa-question-circle"></i>
                        </span>
                    </label>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm text-gray-500 mb-1">Length (inches)</label>
                            <div class="relative">
                                <input type="number" name="length" min="1" step="0.1" 
                                       class="w-full rounded-md border-gray-300" required
                                       placeholder="e.g., 48">
                                <div class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400">in</div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-500 mb-1">Width (inches)</label>
                            <div class="relative">
                                <input type="number" name="width" min="1" step="0.1" 
                                       class="w-full rounded-md border-gray-300" required
                                       placeholder="e.g., 24">
                                <div class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400">in</div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-500 mb-1">Height (inches)</label>
                            <div class="relative">
                                <input type="number" name="height" min="1" step="0.1" 
                                       class="w-full rounded-md border-gray-300" required
                                       placeholder="e.g., 36">
                                <div class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400">in</div>
                            </div>
                        </div>
                    </div>
                    <p class="mt-1 text-sm text-gray-500">Standard crates range from 12" to 144" per dimension</p>
                </div>

                <!-- Weight -->
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-2">
                        Approximate Weight
                        <span class="text-wood-brown ml-1" title="Enter the total weight including contents">
                            <i class="fas fa-question-circle"></i>
                        </span>
                    </label>
                    <div class="relative">
                        <input type="number" name="weight" min="1" class="w-full rounded-md border-gray-300" required
                               placeholder="e.g., 1000">
                        <div class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400">lbs</div>
                    </div>
                    <p class="mt-1 text-sm text-gray-500">Standard weight limit is 50,000 lbs</p>
                </div>

                <!-- Special Requirements -->
                <div class="space-y-4">
                    <label class="block text-sm font-medium text-gray-600">
                        Special Requirements
                        <span class="text-wood-brown ml-1" title="Select any additional protection needed">
                            <i class="fas fa-question-circle"></i>
                        </span>
                    </label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white p-4 rounded-lg border border-gray-200 hover:border-wood-brown transition-colors">
                            <label class="flex items-start cursor-pointer">
                                <input type="checkbox" name="requirements[]" value="moisture_barrier" 
                                       class="rounded border-gray-300 text-wood-brown mt-1">
                                <div class="ml-2">
                                    <span class="font-medium">Moisture Barrier</span>
                                    <p class="text-sm text-gray-500">Protection against humidity and water damage</p>
                                </div>
                            </label>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200 hover:border-wood-brown transition-colors">
                            <label class="flex items-start cursor-pointer">
                                <input type="checkbox" name="requirements[]" value="shock_absorption" 
                                       class="rounded border-gray-300 text-wood-brown mt-1">
                                <div class="ml-2">
                                    <span class="font-medium">Shock Absorption</span>
                                    <p class="text-sm text-gray-500">Added protection against impacts and vibrations</p>
                                </div>
                            </label>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200 hover:border-wood-brown transition-colors">
                            <label class="flex items-start cursor-pointer">
                                <input type="checkbox" name="requirements[]" value="custom_foam" 
                                       class="rounded border-gray-300 text-wood-brown mt-1">
                                <div class="ml-2">
                                    <span class="font-medium">Custom Foam Inserts</span>
                                    <p class="text-sm text-gray-500">Custom-cut foam for precise fit and protection</p>
                                </div>
                            </label>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200 hover:border-wood-brown transition-colors">
                            <label class="flex items-start cursor-pointer">
                                <input type="checkbox" name="requirements[]" value="ramp_system" 
                                       class="rounded border-gray-300 text-wood-brown mt-1">
                                <div class="ml-2">
                                    <span class="font-medium">Ramp System</span>
                                    <p class="text-sm text-gray-500">Built-in ramp for easy loading/unloading</p>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Shipping Details -->
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-2">
                        Shipping Destination
                        <span class="text-wood-brown ml-1" title="Select your shipping destination type">
                            <i class="fas fa-question-circle"></i>
                        </span>
                    </label>
                    <select name="shipping_type" class="w-full rounded-md border-gray-300" required>
                        <option value="domestic">Domestic (United States)</option>
                        <option value="international">International (ISPM 15 Certified)</option>
                    </select>
                    <p class="mt-1 text-sm text-gray-500">International shipping requires ISPM 15 certification</p>
                </div>

                <button type="submit" id="calculateButton" class="w-full btn-wood py-3 px-4 rounded-md flex items-center justify-center">
                    <span class="loading-spinner hidden mr-2">
                        <i class="fas fa-spinner fa-spin"></i>
                    </span>
                    Calculate Quote
                </button>
            </form>

            <!-- Quote Result -->
            {% if estimated_quote %}
            <div class="mt-8 p-6 border-t border-gray-200">
                <h3 class="text-xl font-semibold mb-4">Estimated Quote Range</h3>
                <div class="bg-wood-accent bg-opacity-10 rounded-lg p-6">
                    <p class="text-3xl font-bold text-wood-dark mb-2">${{ estimated_quote.min }} - ${{ estimated_quote.max }}</p>
                    <div class="space-y-4">
                        <p class="text-sm text-gray-600">This is a preliminary estimate based on provided specifications. Contact us for a detailed quote.</p>
                        <ul class="text-sm text-gray-600 space-y-2">
                            <li class="flex items-center">
                                <i class="fas fa-info-circle text-wood-brown mr-2"></i>
                                Final price may vary based on specific requirements
                            </li>
                            <li class="flex items-center">
                                <i class="fas fa-info-circle text-wood-brown mr-2"></i>
                                Volume discounts available for multiple units
                            </li>
                        </ul>
                        <div class="mt-6">
                            <a href="{{ url_for('contact') }}" class="inline-block btn-wood py-2 px-6 rounded-md">
                                Request Detailed Quote
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('quoteForm');
    const packageTypeSelect = form.elements.package_type;
    const descriptionElement = document.querySelector('.package-description');
    const calculateButton = document.getElementById('calculateButton');
    const loadingSpinner = document.querySelector('.loading-spinner');

    // Update package description when selection changes
    packageTypeSelect.addEventListener('change', function() {
        const selectedOption = this.options[this.selectedIndex];
        const description = selectedOption.dataset.description || '';
        descriptionElement.textContent = description;
    });

    form.addEventListener('submit', function(e) {
        const length = parseFloat(this.elements.length.value);
        const width = parseFloat(this.elements.width.value);
        const height = parseFloat(this.elements.height.value);
        const weight = parseFloat(this.elements.weight.value);
        let hasError = false;
        let errorMessage = [];
        
        // Validate dimensions
        if (length * width * height > 1000000) {
            hasError = true;
            errorMessage.push('Package dimensions exceed maximum size limit.');
        }
        
        // Validate weight
        if (weight > 50000) {
            hasError = true;
            errorMessage.push('Weight exceeds maximum limit of 50,000 lbs.');
        }

        if (hasError) {
            e.preventDefault();
            const errorHtml = `
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4">
                    <strong class="font-bold">Please note:</strong>
                    <ul class="list-disc ml-5 mt-2">
                        ${errorMessage.map(msg => `<li>${msg}</li>`).join('')}
                    </ul>
                    <p class="mt-2">For specialized requirements, please <a href="/contact" class="underline">contact us directly</a> for a custom quote.</p>
                </div>
            `;
            const existingError = form.querySelector('.bg-red-100');
            if (existingError) {
                existingError.remove();
            }
            form.insertAdjacentHTML('afterbegin', errorHtml);
            window.scrollTo({ top: form.offsetTop - 20, behavior: 'smooth' });
        } else {
            // Show loading state
            calculateButton.disabled = true;
            loadingSpinner.classList.remove('hidden');
            calculateButton.querySelector('span:not(.loading-spinner)').textContent = 'Calculating...';
        }
    });

    // Add real-time validation feedback
    const dimensionInputs = form.querySelectorAll('input[type="number"]');
    dimensionInputs.forEach(input => {
        input.addEventListener('input', function() {
            const value = parseFloat(this.value);
            const min = parseFloat(this.min);
            const isValid = !isNaN(value) && value >= min;
            
            this.classList.toggle('border-red-500', !isValid);
            this.classList.toggle('border-green-500', isValid);
            
            const feedback = this.parentElement.querySelector('.validation-feedback');
            if (!isValid && this.value !== '') {
                if (!feedback) {
                    const feedbackEl = document.createElement('p');
                    feedbackEl.className = 'validation-feedback text-red-500 text-sm mt-1';
                    feedbackEl.textContent = `Please enter a valid number greater than ${min}`;
                    this.parentElement.appendChild(feedbackEl);
                }
            } else if (feedback) {
                feedback.remove();
            }
        });
    });
});
</script>
{% endblock %}
